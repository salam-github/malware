import os
from cryptography.fernet import Fernet
import tkinter as tk
from tkinter import simpledialog, messagebox

# Decrypt a file
def decrypt_file(file_path, key):
    fernet = Fernet(key)
    with open(file_path, 'rb') as file:
        encrypted_data = file.read()
    decrypted_data = fernet.decrypt(encrypted_data)
    with open(file_path, 'wb') as file:
        file.write(decrypted_data)

# Decrypt all .enc files on the desktop
def decrypt_files_on_desktop(key):
    desktop_path = os.path.join(os.path.join(os.environ['USERPROFILE']), 'Desktop')
    for root, dirs, files in os.walk(desktop_path):
        for file in files:
            if file.endswith('.enc'):
                decrypt_file(os.path.join(root, file), key)

# Main function to run the decryption with GUI
def main():
    root = tk.Tk()
    root.withdraw()  # Hide the main window

    key_input = simpledialog.askstring("Decryption Key", "Enter the decryption key:")

    if key_input:
        key = key_input.encode()
        try:
            decrypt_files_on_desktop(key)
            messagebox.showinfo("Success", "Files have been successfully decrypted.")
        except Exception as e:
            messagebox.showerror("Error", "Invalid decryption key or decryption failed.")
    else:
        messagebox.showwarning("Warning", "No decryption key entered.")

if __name__ == "__main__":
    main()
